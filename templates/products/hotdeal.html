<div class="card mb-3">
  <div class="row g-0">
    <div class="col-md-4 d-flex ">
      <img
        class="img-fluid"
        src="{{ hotdeal.image.url }}"
        alt="{{ hotdeal.title }}"
        
      />
    </div>
    <div class="col-md-8">
      <div class="card-body">
        <h2 class="card-title">{{ hotdeal.title }}</h2>
        <hr>
        <p class="text-muted card-text ">{{ hotdeal.category }}</p>
        <p class="card-text fs-2"><strike class="text-muted fs-5">
          {{ hotdeal.oldPrice }} {{ restaurant.currency }}</strike>
          {{ hotdeal.newPrice }} {{ restaurant.currency }}
        </p>
        <p class="text-danger card-text countdown bg-light text-center position-absolute top-0 end-0 p-2  " style="border-radius:30px 0px 30px 0px;" data-end-time="{{ hotdeal.end_time|date:'c' }}"></p>

        
        
        
        <p class="text-muted card-text">{{ hotdeal.description }}</p>
        <p class="text-muted card-text">{{ hotdeal.end_time }}</p>
        {% if user.is_authenticated %}
        <a href="{% url 'editHotdeal' hotdeal.id %}" class="btn btn-primary">
          DÃ¼zenle
        </a>
        {% else %}
        <a
          href="https://wa.me/{{ restaurant.whatsapp }}?text={{ hotdeal.buyingMassage }}"
          target="_blank"
          class="btn btn-success"
        >
          WhatsApp
        </a>
        <a href="{% url 'viewHotdeal' hotdeal.id %}" class="btn btn-info">
          Fazla
        </a>
        {% endif %}
      </div>
      
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      function updateCountdown() {
          const countdownElements = document.querySelectorAll('.countdown');
          const now = new Date().getTime();

          countdownElements.forEach(element => {
              const endTimeString = element.getAttribute('data-end-time');
              const endTime = new Date(endTimeString).getTime();

              // Check if endTime is valid
              if (isNaN(endTime) || endTime <= 0) {
                  element.innerHTML = 'Invalid date';
                  return;
              }

              const timeRemaining = endTime - now;

              if (timeRemaining < 0) {
                  element.innerHTML = 'Deal has ended';
                  // Remove the entire deal card from the DOM
                  const card = element.closest('.col-md-4');
                  if (card) {
                      card.remove();
                  }
              } else {
                  const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                  const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                  const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                  const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

                  element.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
              }
          });
      }

      // Initial update
      updateCountdown();
      // Update countdown every second
      setInterval(updateCountdown, 1000);
  });
</script>